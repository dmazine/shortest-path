<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Shortest Path</title>

	<!-- Style sheets -->
	<link rel="stylesheet" href="dojo/1.9.3/dojo/resources/dojo.css">
	<link rel="stylesheet" href="dojo/1.9.3/dijit/themes/claro/claro.css">
	<link rel="stylesheet" href="dojo/1.9.3/dojox/grid/resources/Grid.css">
	<link rel="stylesheet" href="dojo/1.9.3/dojox/grid/resources/claroGrid.css">
	<link rel="stylesheet" href="css/style.css">

	<!-- Scripts -->
	<script src="dojo/1.9.3/dojo/dojo.js"
		data-dojo-config="isDebug: true, parseOnLoad:true, async: true"></script>

	<script>
		require([
			"dijit/layout/TabContainer",
			"dijit/layout/ContentPane",
		    "dijit/form/Textarea",
			"dijit/form/Button",
			"dijit/registry",
			"dojox/grid/DataGrid",
			"dojox/layout/TableContainer",
			"dojox/validate",
			"dojox/validate/web",
			"dojo/parser",
			"dojo/domReady!"
		]);
	</script>
</head>

<body class="claro">

	<h2>Finds the shortest path between two locations</h2>
	
	<div style="width: 350px; height: 300px">
	
		<div data-dojo-type="dijit/layout/TabContainer"
			style="width: 100%; height: 100%;">
			
			<div data-dojo-type="dijit/layout/ContentPane" title="Adds a Logistics Network" data-dojo-props="selected:true">
					<div data-dojo-type="dojox/layout/TableContainer" data-dojo-props="cols:1">
						<input id="networkName" title="Network Name: " data-dojo-type="dijit/form/TextBox" value="Sample" />
						<textarea id="logisticsNetwork" name="logisticsNetwork" title="Logistics Network: " data-dojo-type="dijit/form/Textarea" style="width: 200px;">A B 10&#10;B D 15&#10;A C 20&#10;C D 30&#10;B E 50&#10;D E 30</textarea>
					</div>
					<button data-dojo-type="dijit/form/Button" type="button">Add
						<script type="dojo/on" data-dojo-event="click" data-dojo-args="evt">
							require([
								"dojo/dom",
								"dojo/json"
							], function(dom, JSON) {
								dojo.xhrPut({
									url: "services/shipping/logisticsNetwork/" + dom.byId("networkName").value,
									putData: dom.byId("logisticsNetwork").value,
									handleAs: "text",
									load: function(response) {
										console.log("xhrPut succeeded", response);
										dojo.byId("addLogisticsNetworkMessage").innerHTML = "<p>Logistics network added</p>";
									},
									error: function(error, ioArgs) {
										console.log("xhrPut failed", error, ioArgs);
										dojo.byId("addLogisticsNetworkMessage").innerHTML = "<h3>" + error + "</h3>";
									}
								});
							});
						</script>					
					</button>
					<div id="addLogisticsNetworkMessage"></div>
			</div>
			
			<div data-dojo-type="dijit/layout/ContentPane" title="Finds the shortest path">
					<div data-dojo-type="dojox/layout/TableContainer" data-dojo-props="cols:1">
						<input id="origin" title="Origin: " data-dojo-type="dijit/form/TextBox" value="A" />
						<input id="destination" title="Destination: " data-dojo-type="dijit/form/TextBox" value="D" />
						<input id="vehicleMileage" title="Vehicle Mileage: " data-dojo-type="dijit/form/TextBox" value="10" />
						<input id="fuelPrice" title="Fuel Price: " data-dojo-type="dijit/form/TextBox" value="2.5" />
					</div>
					<button data-dojo-type="dijit/form/Button" type="button">Find
						<script type="dojo/on" data-dojo-event="click" data-dojo-args="evt">
							require([
								"dojo/dom",
								"dojo/io-query",
								"dojo/_base/array"
							], function(dom, ioQuery, array) {
								var queryString = ioQuery.objectToQuery({
									vehicleMileage: dom.byId("vehicleMileage").value,
									fuelPrice: dom.byId("fuelPrice").value
								});

								var url = "/shortest-path/services/shipping/shippingDetails"
									+ "/" + dom.byId("origin").value
									+ "/" + dom.byId("destination").value
									+ "?" + queryString;

								dojo.xhrGet({
									url: url,
									handleAs:"json",
									load: function(response) {
										console.log("xhrGet succeeded", response);
										if (response) {
											var route = "";
											array.forEach(response.shippingRoute.legs, function(leg, i){
												if (i == 0) {
													route += leg.origin;
												}
												route += " " + leg.destination;
											});
											dojo.byId("findShortestPathMessage").innerHTML = "<p>Route: " + route + "<br>Rate: " + response.shippingRate + "</p>";
										} else {
											dojo.byId("findShortestPathMessage").innerHTML = "<h3>No route found between the origin and destination</h3>";
										}
									},
									error: function(error, ioArgs) {
										console.log("xhrGet failed", error, ioArgs);
										dojo.byId("findShortestPathMessage").innerHTML = "<h3>" + error + "</h3>";
									}
								});
							});
						</script>					
					</button>
					<div id="findShortestPathMessage"></div>
			</div>
		</div>
	</div>
</body>
</html>